{% extends "hvacbase.html" %}
{% block content %}

<style>
#suppliers {
    border-collapse: collapse;
    width: 100%;
}

#suppliers td, #suppliers th {
    border: 1px solid #ddd;
    padding: 10px;
}

#suppliers tr:{background-color: white}

#suppliers tr:hover {background-color: #ddd;}

#suppliers th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
    background-color: lightsteelblue;
    color: black;
}

.bgimgs {

    background-image: url('http://www.neo-decor.com/wp-content/uploads/2015/01/living-room-grey-fabric-sofa-on-green-rug-connected-by-white-wall-theme-fashionable-look-of-design-interior-living-room-minimalist-as-your-inspiration.jpg');
    min-height: 100%;
    background-position: center;
    background-size: 100% 100% ;
    color: black;   
    

}


</style>

<body onload="createTableSup();">
<div class="bgimgs w3-display-container w3-animate-opacity w3-text-white" style="width:100%; height:100%;">
<div class="w3-main" style="margin-left:300px;">

    <header class="w3-container" style="padding-top:86px">
      <h5 style="color:steelblue;text-align: center;"><b>Suppliers</b></h5>
    </header>

	<hr>

	<div class="w3-half w3-container" style="padding-top:13px; text-align: center">

<div id="map" style="width:90%; height:40%; color: black;"></div>
      <script>
        var map, infoWindow,count,marker,data;
        var locations = [];
        function get_suppliers(){
          var poolDataDEAL = {
            UserPoolId : 'us-east-1_QFcNXf7g8', // Your user pool id here
            ClientId : '4ut1fjlf1v35jbj2v9cks6981l' // Your client id here
          };
          // var url_name = "https://cl0igb14s8.execute-api.us-east-1.amazonaws.com/michael";
          // var url_name = "https://qvtsi28b2k.execute-api.us-east-1.amazonaws.com/kristen";
          var url_name = "https://7srr0yyhjg.execute-api.us-east-1.amazonaws.com/jenny";
          var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolDataDEAL);
          var cognitoUser = userPool.getCurrentUser();

          if(cognitoUser !== null){
              cognitoUser.getSession(function(err, session) {
                  if(err){
                      alert(err);
                      return;
                  }

                  console.log('session validity: ' + session.isValid());
                  console.log(cognitoUser.username);

                  var request = new XMLHttpRequest();
                  request.open('GET', url_name + "/testdeal?vi=" + cognitoUser.username, false);  // `false` makes the request synchronous
                  request.send(null);

                  if (request.status === 200) {
                    console.log(request.response);
                    data = request.response;
                    var tempInfo = JSON.parse(data)[0]; //save please
                    var comp = tempInfo.company;                    
                    console.log(comp)
                    var request = new XMLHttpRequest();
                    request.open('GET', url_name + "/testdeal?s=" + comp, false);  // `false` makes the request synchronous
                    request.send(null);

                    if (request.status === 200) {
                      console.log(request.response);
                      data = request.response;
                      var tempInfo = JSON.parse(data); //save please
                      for(var i = 0, size = tempInfo.length; i < size ; i++){
                        var item = tempInfo[i];
                        var l = item['location'].split(', ');
                        locations.push([item['companyname'],parseFloat(l[0]),parseFloat(l[1])]);
                      }
                    }
                  }
            });
          }
        }
        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 35.397, lng: -95.644},
            zoom: 15
          });
          infoWindow = new google.maps.InfoWindow;
          // locations = [ ];
      	// for (count=0; count<locations.length; count++) {
      	// 	marker= new google.maps.Marker({
      	// 		position: new google.maps.LatLng(locations[count][1], locations[count][2]), 
      	// 		map:map,
      	// 		title: locations[count][0]
      	// 	});
      	
       //  }
  	    // }
          get_suppliers();
          console.log('hi');
          console.log(locations);

          for (count=0; count<locations.length; count++) {
            marker= new google.maps.Marker({
              position: new google.maps.LatLng(locations[count][1], locations[count][2]), 
              map:map,
              title: locations[count][0]
            });
          
          }
        
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent('Location found.');
              infoWindow.open(map);
              map.setCenter(pos);
            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            handleLocationError(false, infoWindow, map.getCenter());
          }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
          infoWindow.open(map);
        }
    }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-hKa4wnF8bY62DoUXjgeNr9oW-KDW2VU&callback=initMap">
    </script>
  </div>


	<div class="w3-half w3-container" style="padding-top:13px; text-align: center">

		<table id="suppliers">
		  <tr style="background-color: lightsteelblue">
		    <th>Name</th>
		    <th>Phone Number</th>
        <th>Components</th>
		  </tr>
		  <!-- <tr style="background-color: white">
		    <td>1</td>
		    <td>Post Malone</td>
		    <td>xxxxxxx</td>
		    <td>xxxxxxx</td>
		  </tr>
		  <tr style="background-color: white">
		    <td>2</td>
		    <td>Jay Z</td>
		    <td>xxxxxxx</td>
		    <td>xxxxxxx</td>
		  </tr>
		  <tr style="background-color: white">
		    <td>3</td>
		    <td>Kendrick Lamar</td>
		    <td>xxxxxxx</td>
		    <td>xxxxxxx</td> -->
		  <!-- </tr> -->
		</table>
	</div>

</div>
</div>
<script src="{{ url_for('static', filename='appdeal.js') }}"></script>
{% for js_url in config.JS_INCLUDES %}
    <script src="{{ js_url }}"></script>
{% endfor %}
</body>

{% endblock %}