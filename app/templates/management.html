{% extends "hvacbase.html" %}
{% block content %}


<style>
  
.bgimgc {

    background-image: url('http://pentium.club/wp-content/uploads/2017/08/empty-bedroom-background-empty-living-room-wall-decorating-clear-bedroom-sets-full.jpg');
    min-height: 100%;
    background-position: center;
    background-size: 100% 100% ;
    color: black;    
}

p {color:black;}

#map {
	height: 100%;
	width: 100%;
}
html, body {
height: 100%;
margin: 0;
padding: 0;
}

</style>

<body>
<div class="bgimgc w3-display-container w3-animate-opacity w3-text-white" style="width:100%; height:100%;">
	<div class="w3-main" style="margin-left:300px;">

	  	<header class="w3-container" style="padding-top:43px;">
	      <h5 style="color: black; text-align:center;"><b>Directions to Your Customer</b></h5>
	  	</header>

		<div class="w3-half w3-container" style="padding-top:43px; text-align: center;">
			<p> Employee lalala </p>
		</div>		

		<div class="w3-half w3-container" style="padding-top:43px; text-align: center;">
			<p> Customer lalala </p>

		</div>
	</div>

	<br><br><br><br>
	<div class="w3-main" style="margin-left:300px; padding-top: 50px;">
		<div class="container" style="width:80%; height:60%;">
			<div id="map" style="width:100%; height: 100%; border: 1px solid black; text-align: center;"></div>


	<script>
	var newcoords;
    var minDistance = 10000;
    var Arraylocation = 0;
    var employee_address = [];
    var employee_coords = [];
    var customer_location= [];
    var supplier_coords = [];
   	var supplier_address = [];
   	var current_location;

	function initMap() {
		var geocoder = new google.maps.Geocoder();
		var distancematrix = new google.maps.DistanceMatrixService();
      	var directionsService = new google.maps.DirectionsService();
		var directionsDisplay = new google.maps.DirectionsRenderer();
//INFO THAT I AM TESTING

	    supplier_address[0] = "1001 Bissonnet St, Houston, TX 77005";
		supplier_address[1] = '31200 Farm to Market 2920, Waller, TX, USA';
		supplier_address[2] = '6521 Westheimer Road, Houston, TX, USA';
		supplier_address[3] = '2506 Hempstead Road, Waller, TX, USA';
		supplier_address[4] = '9649 Barker Cypress Road, Cypress, TX, USA';
		employee_address[0] = '31380 Farm to Market Road 2920, Tomball, TX, USA';
 
 		var request = new XMLHttpRequest();
        request.open('GET', url_name + "/testdeal?vi=" + cognitoUser.username, false);  // `false` makes the request synchronous
        request.send(null);

        if (request.status === 200) {

        }

/*
//VENDOR TWO INFO

	    supplier_address[0] = '4524 Highway 6, Houston, TX, USA';
		supplier_address[1] = '31200 Farm to Market 2920, Waller, TX, USA';
		supplier_address[2] = '6521 Westheimer Road, Houston, TX, USA';
		supplier_address[3] = '2506 Hempstead Road, Waller, TX, USA';
		supplier_address[4] = '9649 Barker Cypress Road, Cypress, TX, USA';


		employee_address[0] = '7406 Ashcroft Dr, Houston, TX 77081, USA';
		employee_address[1] = '31380 Farm to Market Road 2920, Tomball, TX, USA';
		employee_address[2] = '650 Ashcroft Dr, Houston, TX 77081, USA';
		employee_address[3] = '9005 Ashcroft Dr, Houston, TX 77081, USA';
		employee_address[4] = '8006 Ashcroft Dr, Houston, TX 77081, USA';
		employee_address[5] = '40000 Farm to Market Road 2920, Tomball, TX, USA';
		employee_address[6] = '5600 Ashcroft Dr, Houston, TX 77081, USA';

*/
//VENDOR ONE INFO
 
	 //    supplier_address[0] = '4524 Highway 6, Houston, TX, USA';
		// supplier_address[1] = '31200 Farm to Market 2920, Waller, TX, USA';
		// supplier_address[2] = '6521 Westheimer Road, Houston, TX, USA';
		// supplier_address[3] = '2506 Hempstead Road, Waller, TX, USA';
		// supplier_address[4] = '9649 Barker Cypress Road, Cypress, TX, USA';


		// employee_address[0] = '31380 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[1] = '21380 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[2] = '19380 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[3] = '7406 Ashcroft Dr, Houston, TX 77081, USA';
		// employee_address[4] = '18380 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[5] = '26380 Farm to Market Road 2920, Tomball, TX, USA'
		// employee_address[6] = '19480 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[7] = '51380 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[8] = '19080 Farm to Market Road 2920, Tomball, TX, USA';
		// employee_address[9] = '23580 Farm to Market Road 2920, Tomball, TX, USA';


	 	if (navigator.geolocation) {
	   		navigator.geolocation.getCurrentPosition(function(position) {
	        	current_location = { // users current location 
	          		lat: position.coords.latitude, //employer info
	          		lng: position.coords.longitude
	        	};
	    		var map = new google.maps.Map(document.getElementById('map'), {
	      			center: current_location, //sets map center to your current location
	      			zoom: 10 //
	    		});
	
			//addmarker(pos , map);
			for (var i = 0; i < employee_address.length ;i++){
				employee_coords[i] = getLatLng(employee_address[i]);
			}
	   		
	   		for (var j = 0; j < supplier_address.length ;j++){
				supplier_coords[j] = getLatLng(supplier_address[j]);
			}
			for (var i = 0; i < employee_address.length ;i++){
				addmarker(employee_coords[i] , map);
			}
	   		
	   		for (var j = 0; j < supplier_address.length ;j++){
				addmarker(supplier_coords[j] , map);
			}
	   		 //make supplier_address an array with suppliers info in it. then make a loop that converts all addresses to lat:lng
	   		console.log("HERE 1");
	   		console.log(employee_coords);
	   		console.log(supplier_coords);

            distancematrix.getDistanceMatrix({
            	//origins : employee_address, //JENNY 
            	origins : [{lat:position.coords.latitude, lng:position.coords.longitude}], //Customer location 
            	destinations : supplier_address,
            	travelMode : "DRIVING",
             	avoidHighways: false,
       			avoidTolls: false,
        		unitSystem: google.maps.UnitSystem.IMPERIAL
          	}, callback);
			});
		}
	}

	function callback (response, status){
		if (status == 'OK') {
			//console.log(response);
        	var origins = response.originAddresses;
         	var destinations = response.destinationAddresses;
          	
          	for (var i = 0; i < origins.length; i++) {
           	var results = response.rows[i].elements; //should always be 1
				
				for (var j = 0; j < results.length; j++) {
         			
         			var element = results[j]; //number of elements depends on the number of destinations 
         			var distance = element.distance.text; // finds distance in the object 
         			var distanceString = distance.split(" ") //splits the object so we can get the number 
         			var distanceNUM = Number(distanceString[0]); //changes string to int   
         		
         			if(distanceNUM < minDistance){
         				minDistance = distanceNUM; //sets min distance
         				Arraylocation = j; //keeps track of which location is the min distance
         			}
         		}
         	} 
         	var supplier_waypoint = [];
         	supplier_waypoint.push({
         		location: supplier_address[0],
         		stopover: true
         	});
         	console.log(supplier_waypoint);
         	console.log(minDistance);
        	console.log(Arraylocation);	
        	//directions stuff here!
        	var directionsService = new google.maps.DirectionsService();
      		var directionsDisplay = new google.maps.DirectionsRenderer();
      		directionsService.route(
      			{
      			origin: employee_address[0], //employee
  				destination: current_location,	//customer
  				waypoints: supplier_waypoint, //suppliers
				provideRouteAlternatives: false,
  				travelMode: 'DRIVING',
  				optimizeWaypoints : true,
  				avoidHighways: false,
       			avoidTolls: false,
       			unitSystem: google.maps.UnitSystem.IMPERIAL
      			}, function(response, status){
      				if (status == "OK"){
      					console.log(response);
      					var map = new google.maps.Map(document.getElementById('map'));
 						directionsDisplay.setMap(map);
      					directionsDisplay.setDirections(response);
      				}
      			}
  			)
      	}
    }
      		
    	

    function addmarker (pos, map){
		var marker = new google.maps.Marker({
    		position : pos,
      		map : map,
    	});
	}

	function getLatLng(address){
		var parsedAddress = address.split(" ").join("+"); //parse address to fit into the url request
		var url = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + parsedAddress + '&key=AIzaSyD-hKa4wnF8bY62DoUXjgeNr9oW-KDW2VU';
		var request = new XMLHttpRequest();
		request.open('GET', url, false);  // `false` makes the request synchronous
		request.send(null);

		if(request.status == 200){
			var newlat1 = JSON.parse(request.response).results[0].geometry.location.lat;//parses JSON file for coords
        	var newlng1 = JSON.parse(request.response).results[0].geometry.location.lng;
        	return { lat : newlat1, lng : newlng1};//finds new lat and lng
		}
	}

	</script>
	<script async defer 
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-hKa4wnF8bY62DoUXjgeNr9oW-KDW2VU&callback=initMap">
	</script>
		
		</div>
	</div>
</div>

</body>

{% for js_url in config.JS_INCLUDES %}
    <script src="{{ js_url }}"></script>
{% endfor %}


{% endblock %}


